<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode">
<!--defaultCSS-->
<title>未命名</title>



<style type="text/css" id="wiz_custom_css">
body
{
    font-family: Segoe UI,"Microsoft YaHei", Georgia,Helvetica,Arial,sans-serif,宋体, PMingLiU,serif;
    font-size: 10.5pt;
    line-height: 1.5;
}
html, body
{
    
    
}
h1 {
    font-size:1.5em;
    font-weight:bold;
}
h2 {
    font-size:1.4em;
    font-weight:bold;
}
h3 {
    font-size:1.3em;
    font-weight:bold;
}
h4 {
    font-size:1.2em;
    font-weight:bold;
}
h5 {
    font-size:1.1em;
    font-weight:bold;
}
h6 {
    font-size:1.0em;
    font-weight:bold;
}
img {
    border:0;
    max-width: 100%;
    height: auto !important;
}
blockquote {
    margin-top:0px;
    margin-bottom:0px;
}
table {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
td {
    border-collapse:collapse;
    border:1px solid #bbbbbb;
}
</style>
<link rel="stylesheet" type="text/css" href="file:///D:/Program Files (x86)/WizNote/files/css/reading/wiz_reading_note.css?t=1461056894" id="wiz_res_wiz_reading_note" wiz_style="unsave" charset="utf-8">
<script type="text/javascript" src="file:///D:\Program Files (x86)\WizNote\WizTools\htmleditor\todo.js" id="wiz_todo_script_id" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file://D:\Program Files (x86)\WizNote\WizTools\htmleditor\dragresize.js" id="wiz_img_resize_script_id" wiz_style="unsave" charset="utf-8"></script><style type="text/css" id="wiz_img_resize_style_id" wiz_style="unsave">.wizimgdragresize {position: absolute;z-index: 1000;border: 1px solid black; background-color: white;} .wizimgdragresize-lt { cursor: nw-resize; } .wizimgdragresize-tm { cursor: n-resize;}.wizimgdragresize-rt {cursor: ne-resize;}.wizimgdragresize-lm {cursor: w-resize;}.wizimgdragresize-rm {cursor: e-resize;}.wizimgdragresize-lb {cursor: sw-resize;}.wizimgdragresize-bm {cursor: s-resize;}.wizimgdragresize-rb { cursor: se-resize; }</style><script type="text/javascript" src="D:\Program Files (x86)\WizNote\WizTools\htmleditor\localize.js?t=1461056895441" id="wiz_editor_localize" wiz_style="unsave" charset="utf-8"></script><style type="text/css" id="wiz_todo_style_id" wiz_link_version="01.00.09">.wiz-todo, .wiz-todo-img {width: 16px; height: 16px; cursor: default; padding: 0 10px 0 2px; vertical-align: -10%;-webkit-user-select: none;} .wiz-todo-label { display: inline-block; padding-top: 7px; padding-bottom: 6px; line-height: 1.5;} .wiz-todo-label-checked { /*text-decoration: line-through;*/ color: #666;} .wiz-todo-label-unchecked {text-decoration: initial;} .wiz-todo-completed-info {padding-left: 44px; display: inline-block; } .wiz-todo-avatar { width:20px; height: 20px; vertical-align: -20%; margin-right:10px; border-radius: 2px;} .wiz-todo-account, .wiz-todo-dt { color: #666; }</style><script type="text/javascript" src="D:\Program Files (x86)\WizNote\WizTools\htmleditor\plugins\wizEditor.js?t=1461056895476" id="wizEditor" wiz_style="unsave" charset="utf-8"></script><link rel="stylesheet" type="text/css" href="D:\Program Files (x86)\WizNote\WizTools\htmleditor\plugins\wiz_writing_note.css?t=1461056895476" id="wiz_res_wiz_writing_note" wiz_style="unsave" charset="utf-8"><script type="text/javascript" src="D:\Program Files (x86)\WizNote\WizTools\htmleditor\plugins\editor_helper.js?t=1461056895738" id="wizEditorHelper" wiz_style="unsave" charset="utf-8"></script></head>

<body contenteditable="true" style=""><header style="margin: 0px 0px 1.5em; padding: 2em 0px 1em; border: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Helvetica, Arial, sans-serif; line-height: 28.796875px; font-size: 19px; vertical-align: baseline; position: relative; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAABCAYAAACsXeyTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQIHWNIS0sr/v//PwMMDzY+ADqMahlW4J91AAAAAElFTkSuQmCC); background-color: rgb(248, 248, 248); color: rgb(49, 48, 48); background-position: 0% 100%; background-repeat: repeat no-repeat;"><h1 class="entry-title" style="margin: 0px; padding: 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 2.6em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px;">Ceph Jewel Preview: A New Store Is Coming, BlueStore</h1><p class="meta" style="margin: 0px; padding: 0px; border: 0px; font-style: inherit; font-variant: inherit; line-height: inherit; font-size: 0.9em; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px; color: rgb(170, 170, 170); position: absolute; top: 0px;"><time datetime="2016-03-21T10:19:00+01:00" pubdate="" data-updated="true" style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;">Mar 21<span style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;">st</span>, 2016</time>&nbsp;|&nbsp;<a href="http://www.sebastien-han.fr/blog/2016/03/21/ceph-a-new-store-is-coming/#disqus_thread" style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(24, 99, 161); -webkit-transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;">Comments</a></p></header><div class="entry-content" style="margin: 0px; padding: 0px; border: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Helvetica, Arial, sans-serif; line-height: 28.796875px; font-size: 19px; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px; color: rgb(49, 48, 48); background-color: rgb(248, 248, 248);"><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><img class="center" src="http://sebastien-han.fr/images/ceph-blue-store.jpg" title="Ceph a new store is coming" style="margin: 0px auto 1.5em; padding: 0px; border: 0.5em solid rgb(255, 255, 255); font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-top-left-radius: 0.3em; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; border-bottom-left-radius: 0.3em; -webkit-box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-sizing: border-box; display: block;"></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">A new way to efficiently store objects using BlueStore.</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><br></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">As mentioned in an old article, thing are moving fast with Ceph and especially around store optimisations. A new initiative was launched earlier this year, code name:&nbsp;<strong style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline;">NewStore</strong>. But is it about?</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">The NewStore is an implementation where the Ceph journal is stored on&nbsp;<a href="http://rocksdb.org/" style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(24, 99, 161); -webkit-transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;">RocksDB</a>&nbsp;but actual objects remain stored on a filesystem. With the help of BlueStore, objects are now stored directly on the block device, without any filesystem interface.</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><br></p><h2 style="margin: 0px 0px 0.5em; padding: 0.8em 0px 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 2em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAABCAYAAACsXeyTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQIHWNIS0sr/v//PwMMDzY+ADqMahlW4J91AAAAAElFTkSuQmCC); background-position: 0% 0%; background-repeat: repeat no-repeat;">I. Rationale</h2><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">What was wrong with FileStore? As you may Ceph stores objects as files on a filesystem, this is basically what we call FileStore. If you want to learn more, please refer to a previous article where I explained&nbsp;<a href="http://www.sebastien-han.fr/blog/2013/12/02/ceph-performance-interesting-things-going-on/" style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; color: rgb(24, 99, 161); -webkit-transition: color 0.3s; white-space: pre-wrap; word-wrap: break-word;">Ceph under the hood</a>. So now, let’s explore why the need of BlueStore emerged.</p><h3 style="margin: 0px 0px 0.5em; padding: 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 1.6em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px;">I.1. Safe transactions</h3><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Ceph is software defined storage solution, so its main purpose is to have your data stored safely and for this we need atomicity. Unfortunately there is no filesystems that provide atomic writes/updates and given that&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Monaco; font-style: inherit; font-variant: inherit; line-height: 1.45em; font-size: 0.8em; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px; display: inline-block; background-color: rgb(255, 255, 255); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; color: rgb(147, 161, 161) !important;">O_ATOMIC</code>&nbsp;never made it into the Kernel. An attempt to fix this using Btrfs (since it provides atomic transactions) was made but did not really succeed.</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Ceph developers had to find an alternative. This alternative you know it pretty well and it is the Ceph journal. However doing write-ahead journaling has a major performance cost since it basically splits performance of your disk into two (when journal and osd data share the same disk).</p><h3 style="margin: 0px 0px 0.5em; padding: 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 1.6em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px;">I.2. Objects enumeration</h3><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">In the context of Ceph, storing objects as files on a POSIX filesystem is not ideal too. Ceph stores object using a hash mechanism, so object names will appear in a funky way such as:&nbsp;<code style="margin: -1px 0px; padding: 0px 0.3em; border: 1px solid rgb(221, 221, 221); font-family: Monaco; font-style: inherit; font-variant: inherit; line-height: 1.45em; font-size: 0.8em; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px; display: inline-block; background-color: rgb(255, 255, 255); border-top-left-radius: 0.4em; border-top-right-radius: 0.4em; border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; color: rgb(147, 161, 161) !important;">rbdudata.371e5017a72.0000000000000000__head_58D36A14__2</code>. For various operations such as scrubbing, backfill and recovery, Ceph needs to retrieve objects and enumerate them. However, POSIX does not offer any good way to read the content of a directory in an ordered fashion. For this, Ceph developers ended up using a couple of ‘hacks’ such as sharding object directories in tiny sub directories so they could list the content, sort it and then use it. But one again in the end, it is another overhead that is being introduced.</p><h2 style="margin: 0px 0px 0.5em; padding: 0.8em 0px 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 2em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAABCAYAAACsXeyTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQIHWNIS0sr/v//PwMMDzY+ADqMahlW4J91AAAAAElFTkSuQmCC); background-position: 0% 0%; background-repeat: repeat no-repeat;">II. Anatomy</h2><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">This is an overview of the new architecture with BlueStore:</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><img class="center" src="http://sebastien-han.fr/images/ceph-bluestore.png" title="Ceph a new store is coming" style="margin: 0px auto 1.5em; padding: 0px; border: 0.5em solid rgb(255, 255, 255); font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-top-left-radius: 0.3em; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; border-bottom-left-radius: 0.3em; -webkit-box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-sizing: border-box; display: block;"></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">In terms of layer of abstractions, the setup and his overhead are quite minimal. This is a deep dive into BlueStore:</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><img class="center" src="http://sebastien-han.fr/images/ceph-inside-bluestore.png" width="600" height="600" title="Deep dive into BlueStore" style="margin: 0px auto 1.5em; padding: 0px; border: 0.5em solid rgb(255, 255, 255); font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-top-left-radius: 0.3em; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; border-bottom-left-radius: 0.3em; -webkit-box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-sizing: border-box; display: block;"></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">As we can see, BlueStore has several internal components but from a general view Ceph object (actual ‘data’ on the picture) will be written directly on the block device. As a consequence we will not need any filesystem anymore, BlueStore consumes a raw partition directly. For metadata that come with an OSD, those will be store on a RocksDB key/value database. Let’s decrypt the layers:</p><ul style="margin: 0px 0px 0.8em; padding: 0px 0px 0px 3em; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; list-style-position: initial; list-style-image: initial; border-collapse: collapse; border-spacing: 0px;"><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">RocksDB, as mentioned is the global entity that contains the WAL journal and metadata (omap)</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">BlueRocksEnv is the interface to interact with RocksDB</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">BlueFS is a minimal C++ filesystem-like, that implements the rocksdb::Env interface (stores RocksDB log and sst files) Because rocksdb normally runs on top of a file system, BlueFS was created. It is a backend layer, RocksDB data are stored on the same block device that BlueStore is using to store its data.</li></ul><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">So what do we store in RocksDB?</p><ul style="margin: 0px 0px 0.8em; padding: 0px 0px 0px 3em; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; list-style-position: initial; list-style-image: initial; border-collapse: collapse; border-spacing: 0px;"><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Objects metadata</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Write-ahead log</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Ceph omap data</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Allocator metadata, the allocator is responsible for determining where the data should be stored. Note that this one is also pluggable.</li></ul><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Now, default’s BlueStore model on your disk:</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><img class="center" src="http://sebastien-han.fr/images/bluestore-on-disk.png" width="600" height="600" title="Default BlueStore model" style="margin: 0px auto 1.5em; padding: 0px; border: 0.5em solid rgb(255, 255, 255); font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-top-left-radius: 0.3em; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; border-bottom-left-radius: 0.3em; -webkit-box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-sizing: border-box; display: block;"></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Basically, we will take a disk and partition it in two:</p><ul style="margin: 0px 0px 0.8em; padding: 0px 0px 0px 3em; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; list-style-position: initial; list-style-image: initial; border-collapse: collapse; border-spacing: 0px;"><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">the first tiny partition will be partitioned using either XFS or ext4. It contains Ceph files (like init system descriptor, status, id, fsid, keyring etc) and RocksDB files (RocksDB metadata and WAL journal).</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">the second is a raw partition without filesystem</li></ul><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">And then an advanced BlueStore model:</p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><img class="center" src="http://sebastien-han.fr/images/bluestore-on-disk-advanced.png" width="600" height="600" title="Advanced BlueStore model" style="margin: 0px auto 1.5em; padding: 0px; border: 0.5em solid rgb(255, 255, 255); font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-top-left-radius: 0.3em; border-top-right-radius: 0.3em; border-bottom-right-radius: 0.3em; border-bottom-left-radius: 0.3em; -webkit-box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-shadow: rgba(0, 0, 0, 0.14902) 0px 1px 4px; box-sizing: border-box; display: block;"></p><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">What’s fascinating about BlueStore is to see how flexible it is. Every component can be stored on a different device. In this picture, RocksDB WAL and DB can be either stored on different devices or on tiny partitions too.</p><h2 style="margin: 0px 0px 0.5em; padding: 0.8em 0px 0px; border: 0px; font-style: inherit; font-variant: inherit; font-weight: 300; line-height: 1.2em; font-size: 2em; vertical-align: baseline; text-rendering: optimizelegibility; color: rgb(18, 113, 138); border-collapse: collapse; border-spacing: 0px; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAABCAYAAACsXeyTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFUlEQVQIHWNIS0sr/v//PwMMDzY+ADqMahlW4J91AAAAAElFTkSuQmCC); background-position: 0% 0%; background-repeat: repeat no-repeat;">III. Key features</h2><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">In order to summarize, let me highlight some of the best features from BlueStore:</p><ul style="margin: 0px 0px 0.8em; padding: 0px 0px 0px 3em; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; list-style-position: initial; list-style-image: initial; border-collapse: collapse; border-spacing: 0px;"><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">No more double writes penalty, as it writes directly on the block device first and then updates object metadata on RocksDB that specifies its location on the drive.</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Setup flexibility: as mention in the last section BlueStore can use up to 3 drives, one for data, one for RocksDB metadata and one for RocksDB WAL. So you can imagine HDD as a data drive, SSD for the RocksDB metadata and one NVRAM for RocksDB WAL.</li><li style="margin: 0px; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">Raw block device usage: as we write directly to a block device we do not suffer the penalty and the overhead of a traditional filesystem. Plus we avoid the redundancy of journaling metadata where filesystems already do their own internal journaling and metadata management.</li></ul><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;"><br></p><blockquote style="margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px 0px 0px 1.5em; border-width: 0px 0px 0px 4px; border-left-style: solid; border-left-color: rgba(211, 64, 74, 0.992157); font-family: inherit; font-style: italic; font-variant: inherit; line-height: 1.5em; font-size: 1.2em; vertical-align: baseline; quotes: none; position: relative; border-collapse: collapse; border-spacing: 0px;"><p style="margin: 0px 0px 0.8em; padding: 0px; border: 0px; font-family: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px;">As soon as Jewel is released, BlueStore will be available. If I’m not mistaken it will be available but let’s consider it as a tech preview, I’m not sure yet if we should put it in production. To be sure carefully read the release changelog as soon as it is available. As we can see, Ceph is putting more and more intelligence into the drive. BlueStore is eliminating the need of the WAL journal dedicated journal with the help of RocksDB. I haven’t run any benchmarks on BlueStore yet but it is possible that we will not any dedicated device for journaling anymore. Which brings awesome perspectives in terms of datacenter management. Each OSD is independent, so it can be easily plugged out a server into another and it will just run. This capability is not new and if I remember correctly this was introduced during Firefly cycle thanks to the udev rules on the system. Basically when you hotplug a new disk containing an OSD on a system, this will trigger a udev event which will activate the OSD on the system. BlueStore simply strengthens this mechanism given that it removes the need of a dedicated device for the Ceph journal depending on what you want to achieve with your cluster. Performance running everything on the same drive should be decent enough for at least Cost/capacity optimized scenarios and potentially throughput optimized.</p><br><div style="color:gray"><small>来源：&nbsp;&lt;<a href="http://www.sebastien-han.fr/blog/2016/03/21/ceph-a-new-store-is-coming/">http://www.sebastien-han.fr/blog/2016/03/21/ceph-a-new-store-is-coming/</a><small>&gt;</small></small></div><small><small>&nbsp;</small></small></blockquote></div>



</body></html>
